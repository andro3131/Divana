---
import { useTranslations, type Locale } from '../../i18n/ui';
import { sectionIds } from '../../i18n/utils';
import SectionHeading from '../ui/SectionHeading.astro';
import { ABOUT_IMAGES } from '../../lib/constants';

interface Props {
  locale: Locale;
}

const { locale } = Astro.props;
const t = useTranslations(locale);
const sectionId = sectionIds.about[locale];

const images = ABOUT_IMAGES;

// Helper for photo markup
const photoClass = (side: 'left' | 'right') =>
  `about-photo about-photo-${side}`;
---

<section id={sectionId} class="py-24 px-4 md:px-8 bg-dark-900 overflow-hidden">
  <div class="max-w-6xl mx-auto">
    <SectionHeading title={t('about.title')} />

    <!-- Mobile layout: alternating image + text blocks -->
    <div class="md:hidden space-y-10">
      <!-- Block 1 -->
      <div class="space-y-5">
        <div class={photoClass('left')} style="--rotate: -3deg" data-slide>
          <div class="mx-auto w-3/4 max-w-[280px] aspect-[4/3] rounded-lg overflow-hidden border-2 border-gold/20 shadow-lg shadow-gold/10 bg-dark-800">
            <img src={images[0].src} alt={images[0].alt} class="w-full h-full object-cover" loading="lazy" />
          </div>
        </div>
        <div class="text-dark-200 leading-relaxed text-base space-y-4" data-animate>
          <p>{t('about.bio1')}</p>
          <p>{t('about.bio2')}</p>
          <p class="text-dark-100 italic">{t('about.bio3')}</p>
        </div>
      </div>

      <!-- Block 2 -->
      <div class="space-y-5">
        <div class={photoClass('right')} style="--rotate: 2deg" data-slide>
          <div class="mx-auto w-3/4 max-w-[280px] aspect-[4/3] rounded-lg overflow-hidden border-2 border-gold/20 shadow-lg shadow-gold/10 bg-dark-800">
            <img src={images[1].src} alt={images[1].alt} class="w-full h-full object-cover" loading="lazy" />
          </div>
        </div>
        <div class="text-dark-200 leading-relaxed text-base space-y-4" data-animate>
          <p>{t('about.bio4')}</p>
          <p>{t('about.bio5')}</p>
        </div>
      </div>

      <!-- Block 3 -->
      <div class="space-y-5">
        <div class={photoClass('left')} style="--rotate: -4deg" data-slide>
          <div class="mx-auto w-3/4 max-w-[280px] aspect-[4/3] rounded-lg overflow-hidden border-2 border-gold/20 shadow-lg shadow-gold/10 bg-dark-800">
            <img src={images[2].src} alt={images[2].alt} class="w-full h-full object-cover" loading="lazy" />
          </div>
        </div>
        <div class="text-dark-200 leading-relaxed text-base space-y-4" data-animate>
          <p>{t('about.bio6')}</p>
          <p>{t('about.bio7')}</p>
        </div>
      </div>

      <!-- Block 4 -->
      <div class="space-y-5">
        <div class={photoClass('right')} style="--rotate: 3deg" data-slide>
          <div class="mx-auto w-3/4 max-w-[280px] aspect-[4/3] rounded-lg overflow-hidden border-2 border-gold/20 shadow-lg shadow-gold/10 bg-dark-800">
            <img src={images[3].src} alt={images[3].alt} class="w-full h-full object-cover" loading="lazy" />
          </div>
        </div>
        <div class="text-dark-200 leading-relaxed text-base space-y-4" data-animate>
          <p>{t('about.bio8')}</p>
          <p>{t('about.bio9')}</p>
        </div>
      </div>

      <!-- Block 5 -->
      <div class="space-y-5">
        <div class={photoClass('left')} style="--rotate: -2deg" data-slide>
          <div class="mx-auto w-3/4 max-w-[280px] aspect-[4/3] rounded-lg overflow-hidden border-2 border-gold/20 shadow-lg shadow-gold/10 bg-dark-800">
            <img src={images[4].src} alt={images[4].alt} class="w-full h-full object-cover" loading="lazy" />
          </div>
        </div>
        <div class="text-dark-200 leading-relaxed text-base space-y-4" data-animate>
          <p>{t('about.bio10')}</p>
          <p class="text-dark-100 italic">{t('about.bio11')}</p>
        </div>
      </div>

      <!-- Block 6 -->
      <div class="space-y-5">
        <div class={photoClass('right')} style="--rotate: 4deg" data-slide>
          <div class="mx-auto w-3/4 max-w-[280px] aspect-[4/3] rounded-lg overflow-hidden border-2 border-gold/20 shadow-lg shadow-gold/10 bg-dark-800">
            <img src={images[5].src} alt={images[5].alt} class="w-full h-full object-cover" loading="lazy" />
          </div>
        </div>
      </div>

      <!-- Block 7 -->
      <div class="space-y-5">
        <div class={photoClass('left')} style="--rotate: -3deg" data-slide>
          <div class="mx-auto w-3/4 max-w-[280px] aspect-[4/3] rounded-lg overflow-hidden border-2 border-gold/20 shadow-lg shadow-gold/10 bg-dark-800">
            <img src={images[6].src} alt={images[6].alt} class="w-full h-full object-cover" loading="lazy" />
          </div>
        </div>
      </div>
    </div>

    <!-- Desktop layout: 3-column with images on sides -->
    <div class="hidden md:grid md:grid-cols-[200px_1fr_200px] lg:grid-cols-[240px_1fr_240px] gap-8 lg:gap-12 items-start">
      <!-- Left column: images 1, 3, 5, 7 -->
      <div class="space-y-16 pt-8">
        <div class={photoClass('left')} style="--rotate: -3deg" data-slide>
          <div class="aspect-[3/4] rounded-lg overflow-hidden border-2 border-gold/20 shadow-lg shadow-gold/10 bg-dark-800">
            <img src={images[0].src} alt={images[0].alt} class="w-full h-full object-cover" loading="lazy" />
          </div>
        </div>
        <div class={photoClass('left')} style="--rotate: -2deg" data-slide>
          <div class="aspect-[3/4] rounded-lg overflow-hidden border-2 border-gold/20 shadow-lg shadow-gold/10 bg-dark-800">
            <img src={images[2].src} alt={images[2].alt} class="w-full h-full object-cover" loading="lazy" />
          </div>
        </div>
        <div class={photoClass('left')} style="--rotate: -4deg" data-slide>
          <div class="aspect-[3/4] rounded-lg overflow-hidden border-2 border-gold/20 shadow-lg shadow-gold/10 bg-dark-800">
            <img src={images[4].src} alt={images[4].alt} class="w-full h-full object-cover" loading="lazy" />
          </div>
        </div>
        <div class={photoClass('left')} style="--rotate: -2deg" data-slide>
          <div class="aspect-[3/4] rounded-lg overflow-hidden border-2 border-gold/20 shadow-lg shadow-gold/10 bg-dark-800">
            <img src={images[6].src} alt={images[6].alt} class="w-full h-full object-cover" loading="lazy" />
          </div>
        </div>
      </div>

      <!-- Center column: text -->
      <div class="space-y-6 text-dark-200 leading-relaxed text-lg" data-animate>
        <p>{t('about.bio1')}</p>
        <p>{t('about.bio2')}</p>
        <p class="text-dark-100 italic">{t('about.bio3')}</p>
        <p>{t('about.bio4')}</p>
        <p>{t('about.bio5')}</p>
        <p>{t('about.bio6')}</p>
        <p>{t('about.bio7')}</p>
        <p>{t('about.bio8')}</p>
        <p>{t('about.bio9')}</p>
        <p>{t('about.bio10')}</p>
        <p class="text-dark-100 italic">{t('about.bio11')}</p>
      </div>

      <!-- Right column: images 2, 4, 6 -->
      <div class="space-y-16 pt-32">
        <div class={photoClass('right')} style="--rotate: 3deg" data-slide>
          <div class="aspect-[3/4] rounded-lg overflow-hidden border-2 border-gold/20 shadow-lg shadow-gold/10 bg-dark-800">
            <img src={images[1].src} alt={images[1].alt} class="w-full h-full object-cover" loading="lazy" />
          </div>
        </div>
        <div class={photoClass('right')} style="--rotate: 2deg" data-slide>
          <div class="aspect-[3/4] rounded-lg overflow-hidden border-2 border-gold/20 shadow-lg shadow-gold/10 bg-dark-800">
            <img src={images[3].src} alt={images[3].alt} class="w-full h-full object-cover" loading="lazy" />
          </div>
        </div>
        <div class={photoClass('right')} style="--rotate: 4deg" data-slide>
          <div class="aspect-[3/4] rounded-lg overflow-hidden border-2 border-gold/20 shadow-lg shadow-gold/10 bg-dark-800">
            <img src={images[5].src} alt={images[5].alt} class="w-full h-full object-cover" loading="lazy" />
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  // IntersectionObserver for slide-in animations on about photos
  // Photos slide in when visible and stay in place
  const slideObserver = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('slide-in');
          slideObserver.unobserve(entry.target);
        }
      });
    },
    { threshold: 0.15 }
  );

  document.querySelectorAll('[data-slide]').forEach((el) => {
    slideObserver.observe(el);
  });

  // Random glow effect cycling between about photos
  const aboutPhotos = document.querySelectorAll('.about-photo');
  let currentGlow: Element | null = null;

  function randomGlow() {
    // Remove glow from previous photo
    if (currentGlow) {
      currentGlow.classList.remove('about-photo-glow');
    }

    // Pick a random photo that has slide-in (is visible)
    const visible = Array.from(aboutPhotos).filter((p) =>
      p.classList.contains('slide-in')
    );

    if (visible.length > 0) {
      // Pick random, avoid same one twice
      let next: Element;
      do {
        next = visible[Math.floor(Math.random() * visible.length)];
      } while (next === currentGlow && visible.length > 1);

      next.classList.add('about-photo-glow');
      currentGlow = next;
    }
  }

  // Start glow cycle after initial slide-ins
  setTimeout(() => {
    randomGlow();
    setInterval(randomGlow, 3000);
  }, 1500);
</script>
