---
import { type Locale } from '../../i18n/ui';
import { sectionIds } from '../../i18n/utils';

interface Props {
  locale: Locale;
}

const { locale } = Astro.props;
const danceId = sectionIds.danceEvenings[locale];
const ctaText = locale === 'sl' ? 'Prijava' : 'Sign up';
const subtitleText = locale === 'sl' ? 'ob živi glasbi' : 'with live music';
const poem1 = locale === 'sl' ? 'Ko se pogled ne umakne.' : 'When gazes hold.';
const poem2 = locale === 'sl' ? 'Ko dotik prebudi gib.' : 'When touch awakens movement.';
const eventDate = '8. 3. 2026 · 18:00–20:00';
const eventLocation = 'Dvorana Stik, Trebnje';
---

<div class="banner-slide-in">
  <div class="banner-wrapper">
    <div class="dance-banner">

      <!-- Flowing curves -->
      <div class="flow-lines">
        <svg viewBox="0 0 440 580" preserveAspectRatio="none">
          <path d="M0,180 Q110,130 220,200 T440,160" stroke="rgba(201,162,78,0.5)" fill="none" stroke-width="0.7">
            <animate attributeName="d" dur="9s" repeatCount="indefinite"
              values="M0,180 Q110,130 220,200 T440,160;M0,200 Q110,170 220,140 T440,190;M0,180 Q110,130 220,200 T440,160" />
          </path>
          <path d="M0,300 Q140,260 280,320 T440,280" stroke="rgba(201,162,78,0.3)" fill="none" stroke-width="0.5">
            <animate attributeName="d" dur="11s" repeatCount="indefinite"
              values="M0,300 Q140,260 280,320 T440,280;M0,280 Q140,310 280,270 T440,310;M0,300 Q140,260 280,320 T440,280" />
          </path>
          <path d="M0,420 Q100,390 200,440 T440,400" stroke="rgba(201,162,78,0.2)" fill="none" stroke-width="0.4">
            <animate attributeName="d" dur="13s" repeatCount="indefinite"
              values="M0,420 Q100,390 200,440 T440,400;M0,400 Q100,430 200,395 T440,425;M0,420 Q100,390 200,440 T440,400" />
          </path>
        </svg>
      </div>

      <canvas id="banner-particles"></canvas>

      <!-- Dancing couple -->
      <div class="dancers">
        <svg viewBox="0 0 340 380" preserveAspectRatio="xMidYMax meet">
          <defs>
            <linearGradient id="bodyGrad" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="rgba(201,162,78,0.32)"/>
              <stop offset="50%" stop-color="rgba(201,162,78,0.16)"/>
              <stop offset="100%" stop-color="rgba(201,162,78,0.02)"/>
            </linearGradient>
            <linearGradient id="dressGrad" x1="0.2" y1="0" x2="0.8" y2="1">
              <stop offset="0%" stop-color="rgba(201,162,78,0.22)"/>
              <stop offset="100%" stop-color="rgba(201,162,78,0.02)"/>
            </linearGradient>
            <linearGradient id="hairGrad" x1="0.5" y1="0" x2="0.2" y2="1">
              <stop offset="0%" stop-color="rgba(201,162,78,0.28)"/>
              <stop offset="100%" stop-color="rgba(201,162,78,0.05)"/>
            </linearGradient>
            <radialGradient id="floorLight" cx="50%" cy="0%" r="80%">
              <stop offset="0%" stop-color="rgba(201,162,78,0.08)"/>
              <stop offset="100%" stop-color="transparent"/>
            </radialGradient>
            <filter id="softGlow">
              <feGaussianBlur stdDeviation="1.5" result="blur"/>
              <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
          </defs>
          <ellipse cx="170" cy="360" rx="150" ry="20" fill="url(#floorLight)"/>
          <g filter="url(#softGlow)">
            <!-- Her -->
            <g>
              <ellipse cx="130" cy="68" rx="13" ry="16" fill="url(#bodyGrad)"/>
              <path d="M122,55 Q108,50 98,58 Q88,68 85,85 Q80,105 78,130 Q75,160 80,185 Q83,195 88,190 Q86,165 88,140 Q90,115 95,95 Q100,78 112,65 Z" fill="url(#hairGrad)"/>
              <path d="M118,52 Q106,44 95,52 Q82,62 76,82 Q70,108 68,140 Q65,170 70,195 Q73,200 76,195 Q72,168 74,140 Q78,108 85,85 Q92,65 108,55 Z" fill="url(#hairGrad)" opacity="0.6"/>
              <path d="M76,130 Q72,155 70,185 Q68,200 72,210" stroke="rgba(201,162,78,0.1)" fill="none" stroke-width="1.2">
                <animate attributeName="d" dur="6s" repeatCount="indefinite" values="M76,130 Q72,155 70,185 Q68,200 72,210;M76,130 Q70,155 65,185 Q62,200 66,212;M76,130 Q72,155 70,185 Q68,200 72,210"/>
              </path>
              <path d="M124,83 Q120,100 118,120 Q116,140 114,160" stroke="url(#bodyGrad)" fill="none" stroke-width="9" stroke-linecap="round"/>
              <path d="M120,86 Q116,115 114,145 Q112,160 110,175 L140,175 Q140,160 139,145 Q138,115 136,86 Z" fill="url(#bodyGrad)" opacity="0.6"/>
              <path d="M134,95 Q150,92 168,90 Q180,88 188,94" stroke="url(#bodyGrad)" fill="none" stroke-width="5" stroke-linecap="round"/>
              <path d="M122,98 Q140,100 158,98" stroke="url(#bodyGrad)" fill="none" stroke-width="4.5" stroke-linecap="round" opacity="0.6"/>
              <path d="M110,175 Q100,210 85,260 Q70,305 55,355 L95,358 Q108,315 118,270 Q124,240 126,215 L130,215 Q132,240 138,272 Q148,318 160,358 L195,355 Q178,305 162,258 Q150,215 140,175 Z" fill="url(#dressGrad)"/>
              <path d="M55,355 Q65,350 75,355 Q85,360 95,358" stroke="rgba(201,162,78,0.1)" fill="none" stroke-width="0.6">
                <animate attributeName="d" dur="5s" repeatCount="indefinite" values="M55,355 Q65,350 75,355 Q85,360 95,358;M53,357 Q63,352 75,357 Q87,362 95,358;M55,355 Q65,350 75,355 Q85,360 95,358"/>
              </path>
            </g>
            <!-- Him -->
            <g>
              <ellipse cx="192" cy="60" rx="13" ry="15" fill="url(#bodyGrad)"/>
              <path d="M180,50 Q185,42 195,42 Q204,42 206,50" stroke="rgba(201,162,78,0.15)" fill="rgba(201,162,78,0.08)" stroke-width="1"/>
              <path d="M192,74 Q190,95 188,120 Q186,145 184,170" stroke="url(#bodyGrad)" fill="none" stroke-width="11" stroke-linecap="round"/>
              <path d="M182,76 Q178,110 176,145 Q175,162 174,180 L208,180 Q208,162 207,145 Q206,110 204,76 Z" fill="url(#bodyGrad)" opacity="0.6"/>
              <path d="M180,92 Q160,98 142,102 Q130,106 120,110" stroke="url(#bodyGrad)" fill="none" stroke-width="6" stroke-linecap="round"/>
              <path d="M204,94 Q220,102 238,96 Q252,88 262,78" stroke="url(#bodyGrad)" fill="none" stroke-width="5.5" stroke-linecap="round"/>
              <path d="M262,78 L266,74" stroke="rgba(201,162,78,0.2)" fill="none" stroke-width="3" stroke-linecap="round"/>
              <path d="M174,180 Q172,215 170,260 Q168,300 166,355 L184,357 Q184,315 185,275 Q186,235 188,205 L192,205 Q194,235 196,275 Q198,315 200,357 L218,355 Q215,300 210,260 Q206,215 208,180 Z" fill="url(#bodyGrad)"/>
            </g>
            <circle cx="264" cy="76" r="2.5" fill="rgba(226,199,122,0.25)">
              <animate attributeName="r" dur="3s" repeatCount="indefinite" values="1.5;3;1.5"/>
              <animate attributeName="opacity" dur="3s" repeatCount="indefinite" values="0.15;0.35;0.15"/>
            </circle>
            <circle cx="155" cy="96" r="8" fill="rgba(201,162,78,0.04)">
              <animate attributeName="r" dur="4s" repeatCount="indefinite" values="6;10;6"/>
            </circle>
          </g>
          <text x="55" y="110" font-size="15" fill="rgba(201,162,78,0.1)" font-family="serif">♪
            <animate attributeName="y" dur="7s" repeatCount="indefinite" values="110;90;110"/>
            <animate attributeName="opacity" dur="7s" repeatCount="indefinite" values="0.06;0.15;0.06"/>
          </text>
          <text x="268" y="130" font-size="13" fill="rgba(201,162,78,0.08)" font-family="serif">♫
            <animate attributeName="y" dur="9s" repeatCount="indefinite" values="130;108;130"/>
          </text>
          <text x="40" y="240" font-size="11" fill="rgba(201,162,78,0.06)" font-family="serif">♩
            <animate attributeName="y" dur="8s" repeatCount="indefinite" values="240;222;240"/>
          </text>
        </svg>
      </div>

      <!-- Corner ornaments -->
      <div class="corner tl"><svg viewBox="0 0 50 50"><path d="M4,4 L20,4" stroke="#C9A24E" fill="none" stroke-width="0.8" opacity="0.5"/><path d="M4,4 L4,20" stroke="#C9A24E" fill="none" stroke-width="0.8" opacity="0.5"/><circle cx="4" cy="4" r="1.5" fill="#C9A24E" opacity="0.35"/><path d="M4,10 Q7,7 10,4" stroke="#C9A24E" fill="none" stroke-width="0.5" opacity="0.3"/></svg></div>
      <div class="corner tr"><svg viewBox="0 0 50 50"><path d="M4,4 L20,4" stroke="#C9A24E" fill="none" stroke-width="0.8" opacity="0.5"/><path d="M4,4 L4,20" stroke="#C9A24E" fill="none" stroke-width="0.8" opacity="0.5"/><circle cx="4" cy="4" r="1.5" fill="#C9A24E" opacity="0.35"/></svg></div>
      <div class="corner bl"><svg viewBox="0 0 50 50"><path d="M4,4 L20,4" stroke="#C9A24E" fill="none" stroke-width="0.8" opacity="0.5"/><path d="M4,4 L4,20" stroke="#C9A24E" fill="none" stroke-width="0.8" opacity="0.5"/><circle cx="4" cy="4" r="1.5" fill="#C9A24E" opacity="0.35"/></svg></div>
      <div class="corner br"><svg viewBox="0 0 50 50"><path d="M4,4 L20,4" stroke="#C9A24E" fill="none" stroke-width="0.8" opacity="0.5"/><path d="M4,4 L4,20" stroke="#C9A24E" fill="none" stroke-width="0.8" opacity="0.5"/><circle cx="4" cy="4" r="1.5" fill="#C9A24E" opacity="0.35"/></svg></div>

      <!-- Content -->
      <div class="banner-content">
        <div class="brand-label">{locale === 'sl' ? 'Divana plesni večer' : 'Divana dance evening'}</div>
        <div class="event-name">Vajin stik</div>
        <div class="banner-subtitle">{subtitleText}</div>
        <div class="divider-line"></div>
        <div class="poem hidden md:block">{poem1}<br/>{poem2}</div>
        <div class="event-info">{eventDate}<br/>{eventLocation}</div>
      </div>

      <!-- CTA at bottom -->
      <div class="bottom-area">
        <a class="cta-btn" href={`#${danceId}`}>{ctaText}</a>
      </div>

      <!-- NOVO!! Pulse Badge -->
      <div class="pulse-badge">
        <div class="pulse-ring"></div>
        <div class="pulse-ring ring2"></div>
        <span>NOVO!!</span>
      </div>

    </div>
  </div>
</div>

<style>
  /* Banner entrance - slide in from right after 2s */
  @keyframes bannerSlideIn {
    from {
      opacity: 0;
      transform: translateX(120px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .banner-slide-in {
    opacity: 0;
    animation: bannerSlideIn 1.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.5s forwards;
  }

  /* Banner float - vertical only */
  @keyframes bannerFloat {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-18px); }
  }

  .banner-wrapper {
    position: relative;
    width: min(374px, 80vw);
    aspect-ratio: 3/4.2;
    max-height: 88vh;
    animation: bannerFloat 4s ease-in-out 2.3s infinite;
  }

  .banner-wrapper::before {
    content: '';
    position: absolute;
    inset: -40px;
    background: radial-gradient(ellipse at center, rgba(201,162,78,0.08) 0%, transparent 70%);
    border-radius: 30px;
    z-index: 0;
    animation: pulseGlow 5s ease-in-out infinite;
  }

  @keyframes pulseGlow {
    0%, 100% { opacity: 0.5; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.04); }
  }

  .dance-banner {
    position: relative;
    width: 100%;
    height: 100%;
    background: rgba(18, 14, 10, 0.75);
    border-radius: 12px;
    overflow: visible;
    border: 1px solid rgba(201,162,78,0.18);
    z-index: 1;
    backdrop-filter: blur(10px);
  }

  .dance-banner::before {
    content: '';
    position: absolute;
    top: -30%; left: 20%; width: 60%; height: 60%;
    background: radial-gradient(ellipse, rgba(180,130,50,0.06) 0%, transparent 70%);
    z-index: 0;
  }

  /* Corner ornaments */
  .corner { position: absolute; width: 40px; height: 40px; z-index: 5; }
  .corner svg { width: 100%; height: 100%; }
  .corner.tl { top: 10px; left: 10px; }
  .corner.tr { top: 10px; right: 10px; transform: scaleX(-1); }
  .corner.bl { bottom: 10px; left: 10px; transform: scaleY(-1); }
  .corner.br { bottom: 10px; right: 10px; transform: scale(-1); }

  #banner-particles { position: absolute; inset: 0; z-index: 2; }

  .flow-lines { position: absolute; inset: 0; z-index: 1; opacity: 0.12; }
  .flow-lines svg { width: 100%; height: 100%; }

  .dancers {
    position: absolute; bottom: 4%; left: 50%; transform: translateX(-50%);
    width: 76%; height: 46%; z-index: 3;
    opacity: 0; animation: fadeInUp 1.8s ease-out 0.6s forwards;
  }

  @keyframes fadeInUp {
    from { opacity: 0; transform: translateX(-50%) translateY(25px); }
    to { opacity: 1; transform: translateX(-50%) translateY(0); }
  }

  .dancers svg {
    width: 100%; height: 100%;
    animation: danceSway 6s ease-in-out infinite;
    transform-origin: center bottom;
  }

  @keyframes danceSway {
    0%, 100% { transform: rotate(-1.5deg) translateX(0); }
    25% { transform: rotate(0.5deg) translateX(3px); }
    50% { transform: rotate(1.5deg) translateX(0); }
    75% { transform: rotate(0deg) translateX(-3px); }
  }

  /* Content */
  .banner-content {
    position: absolute; top: 0; left: 0; right: 0;
    z-index: 10; text-align: center; padding: 22px 20px;
  }

  .brand-label {
    font-family: 'Playfair Display', serif;
    font-size: clamp(12px, 3vw, 15px);
    letter-spacing: 0.35em; text-transform: uppercase;
    color: #C9A24E;
    opacity: 0; animation: fadeInBanner 1s ease-out 0.7s forwards;
    margin-bottom: 8px; font-weight: 700;
  }

  .event-name {
    font-family: 'Playfair Display', serif;
    font-style: italic; font-weight: 700;
    font-size: clamp(40px, 11vw, 56px);
    line-height: 1;
    background: linear-gradient(160deg, #E2C77A 0%, #C9A24E 35%, #8A6A20 65%, #E2C77A 100%);
    background-size: 200% 200%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: shimmer 5s ease-in-out infinite, fadeInBanner 1.2s ease-out 0.9s forwards;
    opacity: 0; margin-bottom: 6px;
  }

  @keyframes shimmer {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }

  @keyframes fadeInBanner {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .banner-subtitle {
    font-family: 'Playfair Display', serif;
    font-size: clamp(12px, 3vw, 15px);
    letter-spacing: 0.2em; color: #EDE0C4;
    opacity: 0; animation: fadeInBanner 1s ease-out 1.2s forwards;
    margin-bottom: 14px;
  }

  .divider-line {
    width: 0; height: 1px;
    background: linear-gradient(90deg, transparent, #D4A853, transparent);
    margin: 0 auto 12px;
    opacity: 0;
    animation: fadeInBanner 1s ease-out 1.4s forwards, expandLine 1.5s ease-out 1.4s forwards;
  }

  @keyframes expandLine {
    from { width: 0; }
    to { width: 70px; }
  }

  .poem {
    font-family: 'Playfair Display', serif;
    font-style: italic;
    font-size: clamp(12px, 2.8vw, 15px);
    color: #D6C9AB; line-height: 1.7;
    opacity: 0; animation: fadeInBanner 1s ease-out 1.6s forwards;
    letter-spacing: 0.02em; margin-bottom: 12px;
  }

  .event-info {
    font-family: 'Playfair Display', serif;
    font-size: clamp(11px, 2.5vw, 13px);
    color: #E2C77A; letter-spacing: 0.1em;
    line-height: 1.7;
    font-weight: 600;
    margin-bottom: 8px;
    opacity: 0; animation: fadeInBanner 1s ease-out 1.3s forwards;
  }

  /* CTA */
  .bottom-area {
    position: absolute; bottom: 20px; left: 0; right: 0;
    text-align: center; z-index: 10;
    opacity: 0; animation: fadeInBanner 1s ease-out 1.4s forwards;
  }

  .cta-btn {
    display: inline-block;
    padding: 11px 34px;
    border: 1.5px solid #C9A24E;
    color: #E2C77A;
    font-family: 'Playfair Display', serif;
    font-size: 12px; font-weight: 600;
    letter-spacing: 0.3em; text-transform: uppercase;
    text-decoration: none; cursor: pointer;
    background: linear-gradient(135deg, rgba(201,162,78,0.08), rgba(201,162,78,0.03));
    transition: all 0.4s ease;
    position: relative; overflow: hidden;
    animation: btnPulse 3s ease-in-out 2.5s infinite;
  }

  @keyframes btnPulse {
    0%, 100% { box-shadow: 0 0 15px rgba(201,162,78,0.08), inset 0 0 15px rgba(201,162,78,0.04); }
    50% { box-shadow: 0 0 25px rgba(201,162,78,0.18), inset 0 0 20px rgba(201,162,78,0.08); }
  }

  .cta-btn::after {
    content: '';
    position: absolute; top: -50%; left: -50%;
    width: 30px; height: 200%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.12), transparent);
    transform: rotate(25deg);
    animation: btnShine 4s ease-in-out 4.5s infinite;
  }

  @keyframes btnShine {
    0%, 100% { left: -50%; }
    50% { left: 150%; }
  }

  .cta-btn:hover {
    border-color: #E2C77A;
    color: #FFF;
    background: linear-gradient(135deg, rgba(201,162,78,0.3), rgba(138,106,32,0.25));
    box-shadow: 0 0 30px rgba(201,162,78,0.25), inset 0 0 20px rgba(201,162,78,0.1);
    transform: translateY(-2px);
  }

  /* Mobile-only overrides */
  @media (max-width: 767px) {
    .dancers {
      left: auto; right: -45px;
      transform: none;
      width: 55%;
      animation: fadeInRight 1.8s ease-out 1.1s forwards;
    }
    @keyframes fadeInRight {
      from { opacity: 0; transform: translateX(25px); }
      to { opacity: 1; transform: translateX(0); }
    }
  }

  @media (max-width: 400px) {
    .banner-content { padding: 20px 16px; }
    .cta-btn { padding: 10px 28px; font-size: 11px; }
  }

  /* NOVO!! Pulse Badge */
  .pulse-badge {
    position: absolute;
    top: -24px;
    right: -24px;
    z-index: 20;
    width: 74px;
    height: 74px;
    border-radius: 50%;
    background: radial-gradient(circle at 45% 40%, #E74C3C, #9B2335);
    display: flex;
    align-items: center;
    justify-content: center;
    transform: rotate(12deg);
    animation: pulseIn 0.5s ease-out 1.8s both;
    box-shadow: 0 4px 18px rgba(192,57,43,0.4);
  }

  .pulse-badge span {
    color: #FFF;
    font-family: 'Playfair Display', serif;
    font-weight: 900;
    font-size: 12px;
    letter-spacing: 0.06em;
    text-shadow: 0 1px 4px rgba(0,0,0,0.4), 0 0 10px rgba(231,76,60,0.3);
    z-index: 2;
    position: relative;
  }

  .pulse-ring {
    position: absolute;
    inset: -4px;
    border-radius: 50%;
    border: 2px solid rgba(231,76,60,0.5);
    animation: ringPulse 2.5s ease-out 2.3s infinite;
  }

  .pulse-ring.ring2 {
    animation-delay: 3.3s;
  }

  @keyframes ringPulse {
    0% { transform: scale(1); opacity: 0.6; }
    100% { transform: scale(1.6); opacity: 0; }
  }

  @keyframes pulseIn {
    0% { opacity: 0; transform: rotate(12deg) scale(0); }
    60% { transform: rotate(12deg) scale(1.1); }
    100% { opacity: 1; transform: rotate(12deg) scale(1); }
  }
</style>

<script>
  // Particle system for dance evening banner
  const canvas = document.getElementById('banner-particles') as HTMLCanvasElement;
  if (canvas) {
    const ctx = canvas.getContext('2d')!;
    let particles: any[] = [];

    function resize() {
      const rect = canvas.parentElement!.getBoundingClientRect();
      canvas.width = rect.width * window.devicePixelRatio;
      canvas.height = rect.height * window.devicePixelRatio;
      canvas.style.width = rect.width + 'px';
      canvas.style.height = rect.height + 'px';
      ctx.setTransform(1, 0, 0, 1, 0, 0);
      ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
    }

    class Particle {
      x: number; y: number; size: number;
      speedY: number; speedX: number;
      opacity: number; flickerSpeed: number; flickerOffset: number;
      r: number; g: number; b: number;
      w: number; h: number; currentOpacity: number;

      constructor(w: number, h: number) {
        this.w = w; this.h = h;
        this.x = Math.random() * w;
        this.y = Math.random() * h;
        this.size = Math.random() * 2.2 + 0.4;
        this.speedY = Math.random() * 0.35 + 0.1;
        this.speedX = (Math.random() - 0.5) * 0.25;
        this.opacity = Math.random() * 0.5 + 0.08;
        this.flickerSpeed = Math.random() * 0.015 + 0.004;
        this.flickerOffset = Math.random() * Math.PI * 2;
        this.r = 180 + Math.random() * 50;
        this.g = 130 + Math.random() * 50;
        this.b = 40 + Math.random() * 40;
        this.currentOpacity = this.opacity;
      }

      reset() {
        this.x = Math.random() * this.w;
        this.y = -5;
      }

      update(t: number) {
        this.y += this.speedY;
        this.x += this.speedX + Math.sin(t * 0.0008 + this.flickerOffset) * 0.12;
        if (this.y > this.h + 5) this.reset();
        this.currentOpacity = this.opacity * (0.4 + 0.6 * Math.sin(t * this.flickerSpeed + this.flickerOffset));
      }

      draw(c: CanvasRenderingContext2D) {
        c.beginPath();
        c.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        c.fillStyle = `rgba(${this.r},${this.g},${this.b},${this.currentOpacity})`;
        c.fill();
        c.beginPath();
        c.arc(this.x, this.y, this.size * 3.5, 0, Math.PI * 2);
        c.fillStyle = `rgba(${this.r},${this.g},${this.b},${this.currentOpacity * 0.1})`;
        c.fill();
      }
    }

    function init() {
      resize();
      const rect = canvas.parentElement!.getBoundingClientRect();
      const count = Math.floor((rect.width * rect.height) / 4000);
      particles = [];
      for (let i = 0; i < count; i++) {
        particles.push(new Particle(rect.width, rect.height));
      }
    }

    function animate(t: number) {
      const rect = canvas.parentElement!.getBoundingClientRect();
      ctx.clearRect(0, 0, rect.width, rect.height);
      particles.forEach(p => { p.update(t); p.draw(ctx); });
      requestAnimationFrame(animate);
    }

    init();
    requestAnimationFrame(animate);
    window.addEventListener('resize', init);
  }
</script>
