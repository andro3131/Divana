---
export const prerender = false;

import AdminLayout from '../../layouts/AdminLayout.astro';

// If already logged in, redirect to admin
const session = Astro.cookies.get('admin-session');
if (session?.value === 'authenticated') {
  return Astro.redirect('/admin');
}
---

<AdminLayout title="Admin Login - Divana">
  <div class="min-h-[70vh] flex items-center justify-center">
    <div class="w-full max-w-sm">
      <h1 class="text-2xl font-heading text-gold text-center mb-8">Admin Prijava</h1>
      <form id="login-form" class="space-y-4">
        <div>
          <label for="password" class="block text-sm text-dark-300 mb-1.5">Geslo</label>
          <input
            type="password"
            id="password"
            name="password"
            required
            autofocus
            class="w-full px-4 py-3 bg-dark-800 border border-dark-600 rounded-lg text-dark-50 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition outline-none"
          />
        </div>
        <button
          type="submit"
          class="w-full py-3 px-6 bg-gradient-to-r from-primary-400 to-primary-600 text-dark-950 font-semibold rounded-lg hover:from-primary-300 hover:to-primary-500 transition-all duration-300"
        >
          Prijava
        </button>
        <div id="login-error" class="hidden text-center py-2 text-red-400 text-sm"></div>
      </form>
    </div>
  </div>
</AdminLayout>

<script>
  const form = document.getElementById('login-form') as HTMLFormElement;
  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const error = document.getElementById('login-error')!;
    const password = (document.getElementById('password') as HTMLInputElement).value;

    try {
      const res = await fetch('/api/admin/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password }),
      });
      if (res.ok) {
        window.location.href = '/admin';
      } else {
        error.classList.remove('hidden');
        error.textContent = 'Napaƒçno geslo';
      }
    } catch {
      error.classList.remove('hidden');
      error.textContent = 'Napaka pri prijavi';
    }
  });
</script>
